# Настройка VK API для получения информации о пользователях

## Типы токенов VK API

### 1. **Service Token (Сервисный ключ) - РЕКОМЕНДУЕТСЯ**
- **Что это**: Токен приложения, не привязанный к конкретному пользователю
- **Преимущества**: 
  - Не истекает
  - Не требует авторизации пользователя
  - Подходит для получения публичной информации
- **Ограничения**: Доступ только к публичным данным
- **Где взять**: В настройках приложения → "Сервисный ключ доступа"

### 2. **User Token (Пользовательский токен)**
- **Что это**: Токен конкретного пользователя
- **Преимущества**: Доступ к личным данным пользователя
- **Недостатки**: Истекает, требует авторизации
- **Где взять**: Через OAuth авторизацию

### 3. **Group Token (Токен группы) - РАБОТАЕТ!**
- **Что это**: Токен сообщества/группы
- **Преимущества**: 
  - Доступ к данным группы
  - **Может получать публичную информацию о пользователях** (имена, аватары)
  - Подходит для вашего случая
- **Недостатки**: Может истекать, требует авторизации
- **Где взять**: Через OAuth авторизацию группы

## Получение Service Token (РЕКОМЕНДУЕТСЯ)

1. **Создайте приложение VK:**
   - Перейдите на https://vk.com/apps?act=manage
   - Нажмите "Создать приложение"
   - Выберите тип "Standalone-приложение"
   - Заполните название и описание

2. **Получите Service Token:**
   - В настройках приложения найдите раздел "Сервисный ключ доступа"
   - Скопируйте токен (он выглядит как длинная строка символов)

3. **Настройте переменные окружения:**
   - Создайте файл `.env` в корне проекта
   - Добавьте: `VITE_VK_ACCESS_TOKEN=your_service_token_here`

## Получение User Token (альтернатива)

Если нужен пользовательский токен:

1. **Сформируйте ссылку авторизации:**
   ```
   https://oauth.vk.com/authorize?client_id=YOUR_APP_ID&display=page&scope=&response_type=token&v=5.131
   ```
   - Замените `YOUR_APP_ID` на ID вашего приложения

2. **Получите токен:**
   - Перейдите по ссылке в браузере
   - Авторизуйтесь в VK
   - Скопируйте токен из URL после редиректа

## Решение проблемы CORS

VK API не разрешает прямые запросы из браузера из-за политики CORS. В проекте настроен прокси-сервер через Vite:

### **Конфигурация прокси (vite.config.ts):**
```typescript
server: {
  proxy: {
    '/api/vk': {
      target: 'https://api.vk.com',
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api\/vk/, ''),
    }
  }
}
```

### **Как это работает:**
- Запросы к `/api/vk/method/users.get` проксируются на `https://api.vk.com/method/users.get`
- Прокси работает только в режиме разработки (`npm run dev`)
- Для продакшена нужен отдельный прокси-сервер

## Использование

Хук `useVkUser` автоматически:
- Получает информацию о пользователях по их VK ID
- Кэширует данные на 30 минут
- Обрабатывает ошибки API
- Предоставляет fallback значения
- **Использует прокси для обхода CORS**

## API Endpoints

Используется метод `users.get` VK API:
- `user_ids` - ID пользователей (через запятую)
- `fields` - поля для получения (photo_200, photo_100, photo_50, screen_name, domain)
- `access_token` - токен доступа
- `v` - версия API (5.131)

## Обработка ошибок

- Если токен не настроен - показывается fallback аватар
- Если пользователь не найден - используется имя из базы данных
- Ошибки API логируются в консоль, но не блокируют интерфейс
